# SPDX-FileCopyrightText: Copyright Â© 2026, Jared Cook
# SPDX-License-Identifier: AGPL-3.0-or-later
---
- name: Get all passwd entries
  ansible.builtin.command: getent passwd
  register: passwd_entries

- name: Filter interactive users with home directories and include root
  ansible.builtin.set_fact:
    interactive_users: >-
      {{
        passwd_entries.stdout_lines
        | select("match", "^.+?:.+?:.+?:.+?:.+?:/home/.+:(/bin/bash|/bin/zsh|/bin/sh)$")
        | list
        + ["root:x:0:0:root:/root:/bin/bash"]
      }}

- name: Print each interactive user
  ansible.builtin.debug:
    msg: "User: {{ user.split(':')[0] }}, Home: {{ user.split(':')[5] }}"
  loop: "{{ interactive_users }}"
  loop_control:
    loop_var: user
    label: "{{ user.split(':')[0] }}"
  tags: never
